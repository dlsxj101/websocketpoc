<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Overlay Window</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: transparent; /* 완전히 투명 */
        font-family: sans-serif;
        color: #fff;
        -webkit-app-region: drag;
        overflow: hidden;
      }
      /* 물고기 이미지 스타일 */
      #fishImg {
        width: 150px;
        height: 150px;
        object-fit: contain;
        position: absolute;
      }
    </style>
    <!-- GSAP CDN (최신 버전으로 업데이트 가능) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
  </head>
  <body>
    <img id="fishImg" src="" alt="fish image" />
    <script>
      // overlay-preload.js를 통해 expose된 overlayAPI를 사용해 fishPath를 받음
      window.overlayAPI.onFishData((fishPath) => {
        console.log('[overlay.html] onFishData - fishPath:', fishPath);
        const fishImg = document.getElementById('fishImg');
        fishImg.src = fishPath;
        // 이미지가 로드되면 애니메이션 시작
        fishImg.onload = () => {
          animateFish(fishImg);
        };
      });

      // animateFish 함수는 물고기 이미지의 랜덤 위치 이동 애니메이션을 구현합니다.
      function animateFish(element) {
        const width = window.innerWidth;
        const height = window.innerHeight;
        // 이미지 크기를 고려해 초기 위치를 설정 (150px는 이미지 크기)
        const startX = Math.random() * (width - 150);
        const startY = Math.random() * (height - 150);
        gsap.set(element, { x: startX, y: startY });

        // 재귀적으로 무한 이동 애니메이션을 수행하는 함수
        function moveFish() {
          // 새로운 랜덤 위치 계산 (화면 범위 내)
          const newX = Math.random() * (width - 150);
          const newY = Math.random() * (height - 150);
          const duration = Math.random() * 5 + 3; // 3 ~ 8초 사이의 애니메이션 지속 시간

          gsap.to(element, {
            x: newX,
            y: newY,
            duration: duration,
            ease: 'power1.inOut',
            onComplete: moveFish,
          });
        }
        moveFish();
      }
    </script>
  </body>
</html>
