<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>My Electron App</title>
    <style>
      /* html, body 전체 높이 및 기본 스타일 */
      html,
      body {
        height: 100%;
        margin: 0;
        overflow: hidden;
      }
      /* 커스텀 타이틀바 스타일 */
      #titlebar {
        position: fixed; /* 항상 최상단에 고정 */
        top: 0;
        left: 0;
        width: 100%;
        height: 40px;
        line-height: 40px;
        padding: 0 10px;
        background-color: #3b82f6;
        color: white;
        font-weight: bold;
        display: flex;
        align-items: center;
        justify-content: space-between;
        z-index: 1000; /* 다른 요소 위에 표시 */
        -webkit-app-region: drag;
      }
      /* 타이틀 영역: 아이콘과 텍스트를 수평 배치 */
      #title {
        display: flex;
        align-items: center;
      }
      /* 아이콘 이미지 스타일 */
      #title img {
        height: 30px;
        margin-right: 10px;
      }
      /* 컨트롤 버튼 영역 */
      #controls {
        display: flex;
        align-items: center;
        margin-right: 15px;
      }
      /* 최소화, 최대화, 닫기 버튼 공통 스타일 */
      #controls button {
        -webkit-app-region: no-drag;
        background: transparent;
        border: none;
        color: white;
        font-size: 16px;
        cursor: pointer;
        margin-left: 5px;
        padding: 4px 8px;
        border-radius: 4px;
        transition: background-color 0.2s ease, transform 0.1s ease;
      }
      /* 버튼 호버 효과: 기본적으로 살짝 확대 및 배경색 변경 */
      #controls button:hover {
        background-color: rgba(255, 255, 255, 0.3);
        transform: scale(1.05);
      }
      /* 버튼 클릭 시 약간 축소 효과 */
      #controls button:active {
        transform: scale(0.95);
      }
      /* 닫기 버튼은 별도 클래스로 붉은 호버 효과 적용 */
      #controls .btn-close:hover {
        background-color: rgba(255, 0, 0, 0.5);
      }
      /* <webview> 스타일: 타이틀바 아래 전체 공간 차지 */
      #content {
        position: absolute;
        top: 40px; /* 타이틀바 높이만큼 아래 */
        left: 0;
        width: 100%;
        height: calc(100% - 40px);
        border: none;
      }
    </style>
  </head>
  <body>
    <!-- 커스텀 타이틀바 -->
    <div id="titlebar">
      <div id="title">
        <!-- public 폴더에 위치한 아이콘 파일 -->
        <img src="public/icon.ico" alt="App Icon" />
        AQoO
      </div>
      <div id="controls">
        <button onclick="minimize()">-</button>
        <button onclick="maximize()">□</button>
        <button class="btn-close" onclick="closeWindow()">×</button>
      </div>
    </div>
    <!-- 외부 URL을 불러올 <webview> 태그 -->
    <webview
      id="content"
      src="https://i12e203.p.ssafy.io"
      preload="file:///D:/workspace/websocketpoc/my-electron-app/webview-preload.js"
    ></webview>

    <!-- IPC 호출 함수 -->
    <script>
      const webview = document.getElementById('content');

      // 1) 웹뷰에서 ipcRenderer.sendToHost('fishPath', fishPath)를 보내면,
      // 2) 아래 ipc-message 이벤트가 발생함
      webview.addEventListener('ipc-message', (event) => {
        if (event.channel === 'fishPath') {
          const fishPath = event.args[0];
          console.log(
            '[parent index.html] Received fishPath from webview:',
            fishPath
          );

          // 여기서 오버레이를 띄우는 IPC 호출
          window.electronAPI.openOverlay(fishPath);
        }
      });
      function minimize() {
        if (window.electronAPI) window.electronAPI.minimize();
      }
      function maximize() {
        if (window.electronAPI) window.electronAPI.maximize();
      }
      function closeWindow() {
        if (window.electronAPI) window.electronAPI.close();
      }
    </script>
  </body>
</html>
